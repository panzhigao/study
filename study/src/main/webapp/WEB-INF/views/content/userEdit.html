<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>My Blog</title>
<link href="http://apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.css" rel="stylesheet">
<link href="$!{rc.contextPath}/static/assets/css/main.css" rel="stylesheet">
<link href="$!{rc.contextPath}/static/frame/bootstrapValidator/bootstrapValidator.css" rel='stylesheet' type='text/css' />
<script src="http://libs.baidu.com/jquery/1.10.2/jquery.min.js"></script>
<!-- <script src="$!{rc.contextPath}/static/assets/js/hover.zoom.js"></script> -->
<!-- <script src="$!{rc.contextPath}/static/assets/js/hover.zoom.conf.js"></script> -->
<script src="$!{rc.contextPath}/static/frame/bootstrapValidator/bootstrapValidator.js"></script>
<link rel="stylesheet" type="text/css" href="http://www.jq22.com/jquery/font-awesome.4.6.0.css">
<link href="$!{rc.contextPath}/static/css/cropper.min.css" rel="stylesheet">
<link href="$!{rc.contextPath}/static/css/sitelogo.css" rel="stylesheet">
<script src="$!{rc.contextPath}/static/js/cropper.js"></script>
<script src="$!{rc.contextPath}/static/js/sitelogo.js"></script>
<script src="http://apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script>
</head>
<body>
	<!-- Static navbar -->
	<div class="navbar navbar-inverse navbar-static-top">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse"
					data-target=".navbar-collapse">
					<span class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="index.html">$!{user.nickname}</a>
			</div>
			<div class="navbar-collapse collapse">
				<ul class="nav navbar-nav navbar-right">
					<li><a href="$!{rc.contextPath}/user/article">编写文章</a></li>
					<li><a href="$!{rc.contextPath}/user/my_articles">我的文章</a></li>
					<li><a href="work.html">Work</a></li>
					<li><a href="about.html">About</a></li>
					<li><a href="contact.html">Contact</a></li>
					<li><a href="$!{rc.contextPath}/user/quit">退出</a></li>
				</ul>
			</div>
		</div>
	</div>
	
	<div id="ww">
		<div class="container">
			<div class="col-lg-8 col-lg-offset-2 centered">
				<form class="form-horizontal" role="form" id="userForm">
					<div class="form-group" >
						<img id="userImg" style="cursor:pointer" class="img-circle" src="#if(!$user.userPortrait) $!{rc.contextPath}/static/assets/img/user.png #else ${user.userPortrait} #end" data-toggle="modal" data-target="#avatar-modal" title="点击更换头像">
						<input type="hidden" name="userPortrait" id="userPortrait">
					</div>
					<div class="form-group">
						<label for="nickname" class="col-sm-2 control-label">昵称</label>
						<div class="col-sm-8">
							<input type="text" placeholder="请输入昵称" class="form-control" id="nickname" name="nickname" value="$!{user.nickname}">
						</div>
					</div>
					<div class="form-group">
						<label for="telephone" class="col-sm-2 control-label">手机号</label>
						<div class="col-sm-8">
							<input type="text" placeholder="请输入手机号" class="form-control" id="telephone" value="$!{user.telephone}"
								name="telephone">
						</div>
					</div>
					<div class="form-group">
						<label for="userBrief" class="col-sm-2 control-label">个人简介</label>
						<div class="col-sm-8">
							<textarea style="resize: none;" placeholder="请输入个人简介" class="form-control col-lg-4" rows="5" name="userBrief">$!{userExtension.userBrief}</textarea>
						</div>
					</div>
					<div class="form-group">
						<button type="submit" id="btnSave" name="submit" class="btn btn-primary">保存</button>
						&nbsp;&nbsp;
						<button type="button" class="btn btn-default" onclick="location.href='$!{rc.contextPath}/user/index'">返回</button>
					</div>
				</form>
			</div>
		</div>
	</div>


	<!-- +++++ Footer Section +++++ -->
	<div id="footer">
		<div class="container">
			<div class="row">
				<div class="col-lg-4">
					<h4>My Bunker</h4>
					<p>
						Some Address 987,<br /> +34 9054 5455, <br /> Madrid, Spain.
					</p>
				</div>

				<div class="col-lg-4">
					<h4>My Links</h4>
					<p>
						<a href="#">Dribbble</a><br /> <a href="#">Twitter</a><br /> <a
							href="#">Facebook</a>
					</p>
				</div>

				<div class="col-lg-4">
					<h4>About Stanley</h4>
					<p>
						This cute theme was created to showcase your work in a simple way.
						Use it wisely.More Templates <a href="http://www.cssmoban.com/"
							target="_blank" title="模板之家">模板之家</a> - Collect from <a
							href="http://www.cssmoban.com/" title="网页模板" target="_blank">网页模板</a>
					</p>
				</div>
			</div>
		</div>
	</div>
	
	<div class="user_pic" style="margin: 10px;">
		<img src=""/>
	</div>

	<div class="modal fade" id="avatar-modal" aria-hidden="true" aria-labelledby="avatar-modal-label" role="dialog" tabindex="-1" >
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<form class="avatar-form">
					<div class="modal-header">
						<button class="close" data-dismiss="modal" type="button">&times;</button>
						<h4 class="modal-title" id="avatar-modal-label">上传图片</h4>
					</div>
					<div class="modal-body">
						<div class="avatar-body">
							<div class="avatar-upload">
								<input class="avatar-src" name="avatar_src" type="hidden">
								<input class="avatar-data" name="avatar_data" type="hidden">
								<label for="avatarInput" style="line-height: 35px;">图片上传</label>
								<button class="btn btn-danger"  type="button" style="height: 35px;" onclick="$('input[id=avatarInput]').click();">请选择图片</button>
								<span id="avatar-name"></span>
								<input class="avatar-input hide" id="avatarInput" name="avatar_file" type="file"></div>
							<div class="row">
								<div class="col-md-9">
									<div class="avatar-wrapper"></div>
								</div>
								<div class="col-md-3">
									<div class="avatar-preview preview-lg" id="imageHead"></div>
								</div>
							</div>
							<div class="row avatar-btns">
								<div class="col-md-4">
									<div class="btn-group">
										<button class="btn btn-danger fa fa-undo" data-method="rotate" data-option="-90" type="button" title="Rotate -90 degrees"> 向左旋转</button>
									</div>
									<div class="btn-group">
										<button class="btn  btn-danger fa fa-repeat" data-method="rotate" data-option="90" type="button" title="Rotate 90 degrees"> 向右旋转</button>
									</div>
								</div>
								<div class="col-md-5" style="text-align: right;">								
									<button class="btn btn-danger fa fa-arrows" data-method="setDragMode" data-option="move" type="button" title="移动">
						            <span class="docs-tooltip" data-toggle="tooltip" title="" data-original-title="$().cropper(&quot;setDragMode&quot;, &quot;move&quot;)">
						            </span>
						          </button>
						          <button type="button" class="btn btn-danger fa fa-search-plus" data-method="zoom" data-option="0.1" title="放大图片">
						            <span class="docs-tooltip" data-toggle="tooltip" title="" data-original-title="$().cropper(&quot;zoom&quot;, 0.1)">
						            </span>
						          </button>
						          <button type="button" class="btn btn-danger fa fa-search-minus" data-method="zoom" data-option="-0.1" title="缩小图片">
						            <span class="docs-tooltip" data-toggle="tooltip" title="" data-original-title="$().cropper(&quot;zoom&quot;, -0.1)">
						            </span>
						          </button>
						          <button type="button" class="btn btn-danger fa fa-refresh" data-method="reset" title="重置图片">
							            <span class="docs-tooltip" data-toggle="tooltip" title="" data-original-title="$().cropper(&quot;reset&quot;)" aria-describedby="tooltip866214">
							       </button>
						        </div>
								<div class="col-md-3">
									<button class="btn btn-danger btn-block avatar-save fa fa-save" type="button" data-dismiss="modal"> 保存修改</button>
								</div>
							</div>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>

	<div class="loading" aria-label="Loading" role="img" tabindex="-1"></div>
	<script src="$!{rc.contextPath}/static/js/html2canvas.min.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
	//做个下简易的验证  大小 格式 
		$('#avatarInput').on('change', function(e) {
			var filemaxsize = 1024 * 5;//5M
			var target = $(e.target);
			var Size = target[0].files[0].size / 1024;
			if(Size > filemaxsize) {
				alert('图片过大，请重新选择!');
				$(".avatar-wrapper").childre().remove;
				return false;
			}
			if(!this.files[0].type.match(/image.*/)) {
				alert('请选择正确的图片!')
			} else {
				var filename = document.querySelector("#avatar-name");
				var texts = document.querySelector("#avatarInput").value;
				var teststr = texts; //你这里的路径写错了
				testend = teststr.match(/[^\\]+\.[^\(]+/i); //直接完整文件名的
				filename.innerHTML = testend;
			}
		
		});

		$(".avatar-save").on("click", function() {
			var img_lg = document.getElementById('imageHead');
			// 截图小的显示框内的内容
			html2canvas(img_lg, {
				allowTaint: true,
				taintTest: false,
				onrendered: function(canvas) {
					canvas.id = "mycanvas";
					//生成base64图片数据
					var dataUrl = canvas.toDataURL("image/jpeg");
					var newImg = document.createElement("img");
					newImg.src = dataUrl;
					$("#userImg").attr('src',dataUrl);
					$("#userPortrait").val(dataUrl); 
				}
			});
		})
</script>

<script>
$(function () {
   $('form').bootstrapValidator({
　　　　　　message : '表单不能为空',
		feedbackIcons : {
			valid : 'glyphicon glyphicon-ok',
			invalid : 'glyphicon glyphicon-remove',
			validating : 'glyphicon glyphicon-refresh'
		},
		fields : {
			"nickname" : {
				message : '用户名不能为空',
				validators : {
					notEmpty : {
						message : '请输入昵称'
					},
					stringLength : {
						min : 2,
						max : 10,
						message : '用户名长度必须在2-10之间'
					},
					regexp : {
						regexp : /^[\u4e00-\u9fff\w]{2,10}$/,
						message : '昵称只能包含中文,字母，数字，点和下划线'
					}
				}
			},
			"telephone" : {
				message : '手机号不能为空',
				validators : {
					notEmpty : {
						message : '请输入手机号'
					},
					regexp:{
                        regexp:/^1[3|5|8]{1}[0-9]{9}$/,
                        message:'请输入正确的手机号码'
                    }
				}
			}
		}
      }).on('success.form.bv', function (e) {
          // Prevent form submission
          e.preventDefault();
          // Get the form instance
          var $form = $(e.target);
          // Get the BootstrapValidator instance
          var bv = $form.data('bootstrapValidator');
          // Use Ajax to submit form data
          $.ajax({
        	  url:"$!{rc.contextPath}/user/doEdit",
        	  data:$form.serialize(),
        	  dataType:"json",
        	  type:"post",
        	  beforeSend:function(){
        		  $("#btnSave").attr({ disabled: "disabled" });
        	  },
        	  success:function(data){
        		  if(data.code=='200'){
        			  alert(data.msg);
        			  location.href="$!{rc.contextPath}/user/index"
        		  }else{
        			  alert(data.msg);
        			  $('#btnSave').removeAttr("disabled");
        		  }
        	  },
        	  error:function(){
        		  alert("修改用户信息失败");
        	  }
          });
          
    });
});
</script>
</body>
</html>
